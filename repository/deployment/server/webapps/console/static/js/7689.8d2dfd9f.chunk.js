"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[7689],{51147:function(e,t,n){n.d(t,{y:function(){return v}});var r=n(26776),o=n(96462),a=n(76742),i=n(68905),l=n(64805),s=n(5554),u=n(23177),c=n(84504),d=n(97532);function f(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"===typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var v=function(e){var t=e.isReadOnly,n=e.emphasize,p=e.triggerSubmit,g=e.onSubmit,v=e.roleObject,y=e.isEdit,h=e.initialValues,b=e.isRole,E=e.isSubmitting,S=e.permissionsToHide,R=e["data-testid"],A=(0,l.$G)().t,O=m((0,i.useState)([]),2),w=O[0],C=O[1],I=m((0,i.useState)([]),2),P=I[0],L=I[1],Z=m((0,i.useState)([]),2),k=Z[0],j=Z[1],N=m((0,i.useState)([]),2),T=N[0],x=N[1],z=m((0,i.useState)(!0),2),U=z[0],G=z[1];(0,i.useEffect)((function(){var e=[];if(d.t.getAllOrganizationLevelPermissions(S).then((function(e){C(e),x([e[0].key.toString()]),G(!1)})),h&&h.length>0){var t=[];h.forEach((function(e){t.push(e.key.toString())})),j(t),null===k||void 0===k||k.forEach((function(t){var n=$(t,w);null!==n&&e.push(n)})),L(e)}b&&v&&(j(v.permissions),null===k||void 0===k||k.forEach((function(t){var n=$(t,w);null!==n&&e.push(n)})),L(e))}),[w.length>0]);var M=function(e,t){if(t.checked){if(!P.find((function(e){return e.key===t.node.key}))){var n,r,o=$(t.node.key,w,!0),a=1;if(null===o||void 0===o||null===(n=o.children)||void 0===n||n.forEach((function(e){P.filter((function(t){return t.key===e.key})).length>0&&++a})),(null===o||void 0===o||null===(r=o.children)||void 0===r?void 0:r.length)===a){var i=P.filter((function(e){e.key.toString().replace(/^\/|\/$/g,"").split("/"),o.key.toString().replace(/^\/|\/$/g,"").split("/")}));L([].concat(f(i),[o]))}else L([].concat(f(P),[t.node]))}}else L(t.checkedNodes)},$=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[t[0]];r.length;){var o=r.shift();if(n){if(o.key===e.slice(0,e.lastIndexOf("/")))return o}else if(o.key===e)return o;o.children&&r.push.apply(r,f(o.children))}return null},H=function(e){return e.isLeaf?null:i.createElement("div",{className:"tree-arrow-wrap"},i.createElement("span",{className:"tree-arrow ".concat(e.expanded?"":"active")},i.createElement("span",null),i.createElement("span",null)))},_=function(){return i.createElement(i.Fragment,null,i.createElement(r.Forms,{submitState:p,onSubmit:function(){g(P)}},U?i.createElement(o.ContentLoader,{className:"p-3",active:!0}):i.createElement("div",{className:"treeview-container"},i.createElement(a.Z,{className:"customIcon","data-testid":"".concat(R,"-tree"),disabled:t,checkedKeys:P.map((function(e){return e.key})),defaultExpandedKeys:T,showLine:!0,showIcon:!1,checkable:!0,selectable:!1,onCheck:M,treeData:w,switcherIcon:H})),y&&!U&&i.createElement(i.Fragment,null,i.createElement(s.Z,{hidden:!0}),i.createElement(u.Z.Row,{columns:1},i.createElement(u.Z.Column,{mobile:16,tablet:16,computer:8},i.createElement(c.Z,{"data-testid":"".concat(R,"-update-button"),primary:!0,type:"submit",loading:E,disabled:E,size:"small",className:"form-button"},A("console:manage.features.roles.addRoleWizard.permissions.buttons.update")))))))};return n?i.createElement(o.EmphasizedSegment,{"data-testid":R,padded:"very"},_()):i.createElement("div",{"data-testid":R},_())};v.defaultProps={emphasize:!0,isReadOnly:!1}},87689:function(e,t,n){n.r(t),n.d(t,{default:function(){return re}});var r=n(96462),o=n(68905),a=n(64805),i=n(83913),l=n(12847),s=n(50714),u=n(57002),c=n(8890),d=n(88742),f=n(26278),m=n(92303),p=n(88650),g=n(49798),v=n(87289),y=n(85027),h=n(23177),b=n(58704),E=n(99104),S=n(5554),R=n(1410),A=n(70515),O=n(84504),w=n(42463),C=n(58107);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){L(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e){return function(e){if(Array.isArray(e))return N(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||j(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}(e,t)||j(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){if(e){if("string"===typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var T=function(e){var t=e.role,n=e.onRoleUpdate,u=e.isReadOnly,c=(0,a.$G)().t,I=(0,i.I0)(),L=k((0,o.useState)(!1),2),j=L[0],N=L[1],T=k((0,o.useState)([]),2),x=T[0],z=T[1],U=k((0,o.useState)([]),2),G=U[0],M=U[1],$=k((0,o.useState)([]),2),H=$[0],_=$[1],D=k((0,o.useState)([]),2),F=D[0],B=D[1],K=k((0,o.useState)(void 0),2),q=K[0],W=K[1],J=k((0,o.useState)(void 0),2),V=J[0],Y=J[1],Q=k((0,o.useState)([]),2),X=Q[0],ee=Q[1],te=k((0,o.useState)([]),2),ne=te[0],re=te[1],oe=k((0,o.useState)(!1),2),ae=oe[0],ie=oe[1],le=k((0,o.useState)(!1),2),se=le[0],ue=le[1],ce=k((0,o.useState)([]),2),de=ce[0],fe=ce[1],me=k((0,o.useState)(!1),2),pe=me[0],ge=me[1],ve=k((0,o.useState)(!0),2),ye=ve[0],he=ve[1],be=k((0,r.useWizardAlert)(),3),Ee=be[0],Se=be[1],Re=be[2],Ae=(0,i.v9)((function(e){return e.organization.organization}));(0,o.useEffect)((function(){t&&(Oe(),fe(t.groups))}),[]),(0,o.useEffect)((function(){re(se?G:[])}),[se]),(0,o.useEffect)((function(){ee(ae?x:[])}),[ae]),(0,o.useEffect)((function(){t&&(Oe(),fe(t.groups))}),[t]),(0,o.useEffect)((function(){(0,w.hI)(null).then((function(e){W(e.data.Resources)})),he(!1)}),[]);var Oe=function(){var e=new Map;t.groups&&t.groups instanceof Array?((0,g.Z)(t.groups,(function(t){var n=t.display.split("/");n[0]!==C.Fn&&n[0]!==C.eT&&e.set(t.display,t.value)})),Y(e)):Y(void 0)},we=function(){ie(!ae)},Ce=function(){ue(!se)},Ie=function(){var e=Z(G);(null===X||void 0===X?void 0:X.length)>0&&X.map((function(t){null!==G&&void 0!==G&&G.includes(t)||e.push(t)})),M(e),B(e),z(x.filter((function(t){return!(null!==e&&void 0!==e&&e.includes(t))}))),_(x.filter((function(t){return!(null!==e&&void 0!==e&&e.includes(t))}))),re([]),ie(!1)},Pe=function(){var e=Z(x);(null===ne||void 0===ne?void 0:ne.length)>0&&ne.map((function(t){null!==x&&void 0!==x&&x.includes(t)||e.push(t)})),z(e),_(e),M(null===G||void 0===G?void 0:G.filter((function(t){return!(null!==e&&void 0!==e&&e.includes(t))}))),B(null===G||void 0===G?void 0:G.filter((function(t){return!(null!==e&&void 0!==e&&e.includes(t))}))),ee([]),ue(!1)},Le=function(){!function(){var e=q?Z(q):[],t=[];if(e&&V){var n=Array.from(null===V||void 0===V?void 0:V.values());(0,p.Z)(e,(function(e){n.includes(null===e||void 0===e?void 0:e.id)&&t.push(e)}))}M(t),B(t),z(e.filter((function(e){return!(null!==t&&void 0!==t&&t.includes(e))}))),_(e.filter((function(e){return!(null!==t&&void 0!==t&&t.includes(e))})))}(),N(!0)},Ze=function(){N(!1)},ke=function(e,t){var n=t.value,r=[];if((0,v.Z)(n))z(H);else{var o=new RegExp((0,m.Z)(n),"i");x&&x.map((function(e){o.test(e.displayName)&&(r.push(e),z(r))}))}},je=function(e,t){var n=t.value,r=[];if((0,v.Z)(n))M(F);else{var o=new RegExp((0,m.Z)(n),"i");G&&(null===G||void 0===G||G.map((function(e){o.test(e.displayName)&&(r.push(e),M(r))})))}},Ne=function(e){var t=null===e||void 0===e?void 0:e.split("/"),n={labelColor:"olive",labelText:C.$R};return t[0]!==C.Fn&&t[0]!==C.eT&&(null===t||void 0===t?void 0:t.length)>1&&(n=P(P({},n),{},{labelText:t[0]})),n},Te=function(e){var t,n=null===(t=e)||void 0===t?void 0:t.split("/");return 1!==(null===n||void 0===n?void 0:n.length)&&(e=n[1]),e};return o.createElement(o.Fragment,null,o.createElement(r.Heading,{as:"h4"},c("console:manage.features.roles.edit.groups.heading"),o.createElement(r.Heading,{subHeading:!0,ellipsis:!0,as:"h6"},c("console:manage.features.roles.edit.groups.subHeading"))),o.createElement(S.Z,{hidden:!0}),o.createElement(h.Z,null,o.createElement(h.Z.Row,null,o.createElement(h.Z.Column,{computer:8},(null===V||void 0===V?void 0:V.size)>0?o.createElement(r.EmphasizedSegment,{"data-testid":"role-mgt-groups-list",className:"user-role-edit-header-segment"},o.createElement(h.Z.Row,null,o.createElement(h.Z.Column,null,o.createElement(R.Z,{"data-testid":"role-mgt-groups-list-search-input",icon:o.createElement(A.Z,{name:"search"}),onChange:function(e,n){var r=n.value,o=[];if((0,v.Z)(r))fe(t.groups);else{var a=new RegExp((0,m.Z)(r),"i");de&&(null===de||void 0===de||de.map((function(e){1===e.display.split("/").length&&a.test(e.display)&&(o.push(e),fe(o))})))}},placeholder:c("console:manage.features.user.updateUser.groups.editGroups.searchPlaceholder"),floated:"left",size:"small"}),!u&&o.createElement(O.Z,{"data-testid":"role-mgt-groups-list-update-button",size:"medium",icon:"pencil",floated:"right",onClick:Le}))),o.createElement(h.Z.Row,null,o.createElement(b.Z,{singleLine:!0,compact:!0},o.createElement(b.Z.Header,null,o.createElement(b.Z.Row,null,o.createElement(b.Z.HeaderCell,null,o.createElement("strong",null,c("console:manage.features.user.updateUser.groups.editGroups.groupList.headers.0"))),o.createElement(b.Z.HeaderCell,null,o.createElement("strong",null,c("console:manage.features.user.updateUser.groups.editGroups.groupList.headers.1"))))),o.createElement(b.Z.Body,null,null===de||void 0===de?void 0:de.map((function(e,t){var n,r=null===e||void 0===e||null===(n=e.display)||void 0===n?void 0:n.split("/");if(r[0]!==C.Fn&&r[0]!==C.eT)return o.createElement(b.Z.Row,{key:t},o.createElement(b.Z.Cell,null,1===(null===r||void 0===r?void 0:r.length)?o.createElement(E.Z,{color:"olive"},C.$R):o.createElement(E.Z,{color:"olive"},r[0])),o.createElement(b.Z.Cell,null,1===(null===r||void 0===r?void 0:r.length)?null===e||void 0===e?void 0:e.display:r[1]))})))))):ye?o.createElement(r.ContentLoader,{className:"p-3",active:!0}):o.createElement(r.EmphasizedSegment,null,o.createElement(r.EmptyPlaceholder,{"data-testid":"role-mgt-empty-groups-list",title:c("console:manage.features.roles.edit.groups.emptyPlaceholder.title"),subtitle:[c("console:manage.features.roles.edit.groups.emptyPlaceholder.subtitles")],action:!u&&o.createElement(r.PrimaryButton,{"data-testid":"role-mgt-empty-groups-list-assign-group-button",icon:"plus",onClick:Le},c("console:manage.features.roles.edit.groups.emptyPlaceholder.action")),image:(0,l.jF)().emptyList,imageSize:"tiny"}))))),o.createElement(y.Z,{"data-testid":"role-mgt-update-groups-modal",open:j,size:"small",className:"user-roles"},o.createElement(y.Z.Header,null,c("console:manage.features.roles.edit.groups.addGroupsModal.heading"),o.createElement(r.Heading,{subHeading:!0,ellipsis:!0,as:"h6"},c("console:manage.features.roles.edit.groups.addGroupsModal.subHeading"))),o.createElement(y.Z.Content,{image:!0},Ee&&Re,o.createElement(r.TransferComponent,{searchPlaceholder:c("console:manage.features.transferList.searchPlaceholder",{type:"groups"}),addItems:Ie,removeItems:Pe,handleUnelectedListSearch:ke,handleSelectedListSearch:je,"data-testid":"role-mgt-update-groups-modal"},o.createElement(r.TransferList,{isListEmpty:!((null===x||void 0===x?void 0:x.length)>0),listType:"unselected",listHeaders:[c("console:manage.features.transferList.list.headers.0"),c("console:manage.features.transferList.list.headers.1"),""],handleHeaderCheckboxChange:we,isHeaderCheckboxChecked:ae,emptyPlaceholderContent:c("console:manage.features.transferList.list.emptyPlaceholders.roles.unselected",{type:"groups"}),"data-testid":"role-mgt-update-groups-modal-unselected-groups-select-all-checkbox",emptyPlaceholderDefaultContent:c("console:manage.features.transferList.list.emptyPlaceholders.default")},null===x||void 0===x?void 0:x.map((function(e,t){return o.createElement(r.TransferListItem,{handleItemChange:function(){return function(e){var t=Z(X);null!==t&&void 0!==t&&t.includes(e)?(t.splice(t.indexOf(e),1),ee(t)):(t.push(e),ee(t))}(e)},key:t,listItem:Te(null===e||void 0===e?void 0:e.displayName),listItemId:e.id,listItemIndex:t,listItemTypeLabel:Ne(null===e||void 0===e?void 0:e.displayName),isItemChecked:X.includes(e),showSecondaryActions:!1,"data-testid":"role-mgt-update-groups-modal-unselected-groups"})}))),o.createElement(r.TransferList,{isListEmpty:!((null===G||void 0===G?void 0:G.length)>0),listType:"selected",listHeaders:[c("console:manage.features.transferList.list.headers.0"),c("console:manage.features.transferList.list.headers.1")],handleHeaderCheckboxChange:Ce,isHeaderCheckboxChecked:se,emptyPlaceholderContent:c("console:manage.features.transferList.list.emptyPlaceholders.roles.selected",{type:"groups"}),"data-testid":"role-mgt-update-groups-modal-selected-groups-select-all-checkbox",emptyPlaceholderDefaultContent:c("console:manage.features.transferList.list.emptyPlaceholders.default")},null===G||void 0===G?void 0:G.map((function(e,t){return o.createElement(r.TransferListItem,{handleItemChange:function(){return function(e){var t=Z(ne);null!==t&&void 0!==t&&t.includes(e)?(t.splice(t.indexOf(e),1),re(t)):(t.push(e),re(t))}(e)},key:t,listItem:Te(null===e||void 0===e?void 0:e.displayName),listItemId:null===e||void 0===e?void 0:e.id,listItemIndex:t,listItemTypeLabel:Ne(null===e||void 0===e?void 0:e.displayName),isItemChecked:ne.includes(e),showSecondaryActions:!1,"data-testid":"role-mgt-update-groups-modal-selected-groups"})}))))),o.createElement(y.Z.Actions,null,o.createElement(h.Z,null,o.createElement(h.Z.Row,{columns:2},o.createElement(h.Z.Column,{mobile:8,tablet:8,computer:8},o.createElement(r.LinkButton,{"data-testid":"role-mgt-update-groups-modal-cancel-button",floated:"left",onClick:Ze},c("common:cancel"))),o.createElement(h.Z.Column,{mobile:8,tablet:8,computer:8},o.createElement(r.PrimaryButton,{"data-testid":"role-mgt-update-groups-modal-save-button",floated:"right",loading:pe,disabled:pe,onClick:function(){return function(e,t){var r={operations:[{op:"REPLACE",path:"groups",value:t.map((function(e){return e.id}))}]};ge(!0),(0,s.LK)(Ae.id,e.id,r).then((function(){I((0,f.addAlert)({description:c("console:manage.features.roles.notifications.updateRole.success.description"),level:d.AlertLevels.SUCCESS,message:c("console:manage.features.roles.notifications.updateRole.success.message")})),Ze(),n(e.id)})).catch((function(e){var t,n,r,o,a,i;404!==(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&(null!==e&&void 0!==e&&e.response&&null!==e&&void 0!==e&&null!==(n=e.response)&&void 0!==n&&n.data&&null!==e&&void 0!==e&&null!==(r=e.response)&&void 0!==r&&null!==(o=r.data)&&void 0!==o&&o.description?Se({description:null===(a=e.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.description,level:d.AlertLevels.ERROR,message:c("console:manage.features.roles.notifications.updateRole.error.message")}):Se({description:c("console:manage.features.roles.notifications.updateRole.genericError.description"),level:d.AlertLevels.ERROR,message:c("console:manage.features.roles.notifications.updateRole.genericError.message")}))})).finally((function(){ge(!1)}))}(t,G)}},c("common:save"))))))))},x=n(51147);function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return U(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var G=function(e){var t=(0,a.$G)().t,n=(0,i.I0)(),r=z((0,o.useState)(!1),2),l=r[0],u=r[1],c=(0,i.v9)((function(e){return e.organization.organization})),m=e.isReadOnly,p=e.roleObject,g=e.onRoleUpdate,v=e.isGroup;return o.createElement("div",{className:"permissions-edit-container"},o.createElement(x.y,{isReadOnly:m,isEdit:!m,isRole:!0,onSubmit:function(e){var r={operations:[{op:"REPLACE",path:"permissions",value:e.map((function(e){return e.key}))}]};u(!0),(0,s.LK)(c.id,p.id,r).then((function(){n((0,f.addAlert)({description:t(v?"console:manage.features.groups.notifications.updateGroup.success.description":"console:manage.features.roles.notifications.updateRole.success.description"),level:d.AlertLevels.SUCCESS,message:t(v?"console:manage.features.groups.notifications.updateGroup.success.message":"console:manage.features.roles.notifications.updateRole.success.message")})),g()})).catch((function(e){e.response&&401!==e.response.status?e.response&&e.response.data.detail?n((0,f.addAlert)({description:t(v?"console:manage.features.groups.notifications.createPermission.error.description":"console:manage.features.roles.notifications.createPermission.error.description",{description:e.response.data.detail}),level:d.AlertLevels.ERROR,message:t(v?"console:manage.features.groups.notifications.createPermission.error.message":"console:manage.features.roles.notifications.createPermission.error.message")})):n((0,f.addAlert)({description:t(v?"console:manage.features.groups.notifications.createPermission.genericError.description":"console:manage.features.roles.notifications.createPermission.genericError.description"),level:d.AlertLevels.ERROR,message:t(v?"console:manage.features.groups.notifications.createPermission.genericError.message":"console:manage.features.roles.notifications.createPermission.genericError.message")})):n((0,f.addAlert)({description:t(v?"console:manage.features.groups.notifications.createPermission.error.description":"console:manage.features.roles.notifications.createPermission.error.description"),level:d.AlertLevels.ERROR,message:t(v?"console:manage.features.groups.notifications.createPermission.error.message":"console:manage.features.roles.notifications.createPermission.error.message")}))})).finally((function(){u(!1)}))},roleObject:p,isSubmitting:l}))},M=n(26776),$=n(44706),H=n(12558);function _(e,t,n,r,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,o)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){_(a,r,o,i,l,"next",e)}function l(e){_(a,r,o,i,l,"throw",e)}i(void 0)}))}}function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var K=function(e){var t=(0,a.$G)().t,n=(0,i.I0)(),u=e.roleId,c=e.roleObject,m=e.onRoleUpdate,p=e.isGroup,g=e.isReadOnly,v=e["data-testid"],y=F((0,o.useState)(!1),2),b=y[0],E=y[1],R=F((0,o.useState)(""),2),A=R[0],w=R[1],I=F((0,o.useState)(""),2),P=I[0],L=I[1],Z=F((0,o.useState)(""),2),k=Z[0],j=Z[1],N=F((0,o.useState)(!0),2),T=N[0],x=N[1],z=F((0,o.useState)(!1),2),U=z[0],G=z[1],_=(F((0,o.useState)(l.fo.PRIMARY_USER_STORE),1)[0],F((0,o.useState)(!1),2)),B=_[0],K=_[1],q=(0,i.v9)((function(e){return e.organization.organization}));(0,o.useEffect)((function(){c&&-1!==c.displayName.indexOf("/")?(L(c.displayName.split("/")[1]),w(c.displayName.split("/")[0])):c&&L(c.displayName)}),[c]),(0,o.useEffect)((function(){""===k&&W().then((function(e){j(e),G(!1)}))}),[P]);var W=function(){var e=D(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",H.o_.RolenameJavaScriptRegEx);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=function(e){n((0,f.addAlert)(e))};return o.createElement(o.Fragment,null,o.createElement(r.EmphasizedSegment,{padded:"very"},o.createElement(M.Forms,{onSubmit:function(e){!function(e){var n,r=null===e||void 0===e||null===(n=e.get("roleName"))||void 0===n?void 0:n.toString(),o={operations:[{op:"REPLACE",path:"displayName",value:[A?A+"/"+r:r]}]};K(!0),(0,s.LK)(q.id,c.id,o).then((function(){m(),J({description:t("console:manage.features.roles.notifications.updateRole.success.description"),level:d.AlertLevels.SUCCESS,message:t("console:manage.features.roles.notifications.updateRole.success.message")})})).catch((function(){J({description:t("console:manage.features.roles.notifications.updateRole.error.description"),level:d.AlertLevels.ERROR,message:t("console:manage.features.roles.notifications.updateRole.error.message")})})).finally((function(){K(!1)}))}(e)}},o.createElement(h.Z,null,o.createElement(h.Z.Row,{columns:1},o.createElement(h.Z.Column,{mobile:12,tablet:12,computer:6},o.createElement($.Z.Field,{error:!T},o.createElement("label",{"data-testid":"".concat(v,p?"-group-name-label":"-role-name-label")},t(p?"console:manage.features.groups.edit.basics.fields.groupName.name":"console:manage.features.roles.edit.basics.fields.roleName.name")),o.createElement(M.Field,{required:!0,name:"roleName",label:""!==A?A+" /":null,requiredErrorMessage:t(p?"console:manage.features.groups.edit.basics.fields.groupName.required":"console:manage.features.roles.edit.basics.fields.roleName.required"),placeholder:t(p?"console:manage.features.groups.edit.basics.fields.groupName.placeholder":"console:manage.features.roles.edit.basics.fields.roleName.placeholder"),value:P,validation:function(){var e=D(regeneratorRuntime.mark((function e(r,o){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=4;break}return a="name eq "+r.toString(),e.next=4,(0,s.Sr)(q.id,a,10,null).then((function(e){var n,r;null!==e&&void 0!==e&&e.Resources&&0!==(null===e||void 0===e||null===(n=e.Resources)||void 0===n?void 0:n.length)&&((null===e||void 0===e||null===(r=e.Resources[0])||void 0===r?void 0:r.id)!==u&&(o.isValid=!1,o.errorMessages.push(t("console:manage.features.roles.addRoleWizard.forms.roleBasicDetails.roleName.validations.duplicate",{type:"Role"}))))})).catch((function(){n((0,f.addAlert)({description:t("console:manage.features.roles.notifications.fetchRoles.genericError.description"),level:d.AlertLevels.ERROR,message:t("console:manage.features.roles.notifications.fetchRoles.genericError.message")}))}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),onChange:function(e,t){x(l.w3.validateInputAgainstRegEx(null===t||void 0===t?void 0:t.value,k))},type:"text","data-testid":"".concat(v,p?"-group-name-input":"-role-name-input"),loading:U,readOnly:g})))),o.createElement(h.Z.Row,{columns:1},o.createElement(h.Z.Column,{mobile:16,tablet:16,computer:8},!g&&o.createElement(O.Z,{primary:!0,type:"submit",size:"small",loading:B,className:"form-button","data-testid":"".concat(v,p?"-group-update-button":"-role-update-button"),disabled:U||B},t("console:manage.features.roles.edit.basics.buttons.update"))))))),o.createElement(S.Z,{hidden:!0}),!g&&(null===c||void 0===c?void 0:c.displayName)!==C.Rw.ORG_CREATOR_ROLE_NAME&&o.createElement(r.DangerZoneGroup,{sectionHeader:"Danger Zone"},o.createElement(r.DangerZone,{actionTitle:t("console:manage.features.roles.edit.basics.dangerZone.actionTitle",p?{type:"Group"}:{type:"Role"}),header:t("console:manage.features.roles.edit.basics.dangerZone.header",p?{type:"group"}:{type:"role"}),subheader:t("console:manage.features.roles.edit.basics.dangerZone.subheader",p?{type:"group"}:{type:"role"}),onActionClick:function(){return E(!b)},"data-testid":"".concat(v,p?"-group-danger-zone":"-role-danger-zone")})),b&&o.createElement(r.ConfirmationModal,{onClose:function(){return E(!1)},type:"negative",open:b,assertionHint:t("console:manage.features.roles.edit.basics.confirmation.assertionHint"),assertionType:"checkbox",primaryAction:"Confirm",secondaryAction:"Cancel",onSecondaryActionClick:function(){return E(!1)},onPrimaryActionClick:function(){return e=c.id,void(0,s.h7)(q.id,e).then((function(){J({description:t("console:manage.features.roles.notifications.deleteRole.success.description"),level:d.AlertLevels.SUCCESS,message:t("console:manage.features.roles.notifications.deleteRole.success.message")}),p?l.m8.push(l.$x.getPaths().get("GROUPS")):l.m8.push(l.$x.getPaths().get("ORGANIZATION_ROLES"))}));var e},"data-testid":"".concat(v,p?"-group-confirmation-modal":"-role-confirmation-modal"),closeOnDimmerClick:!1},o.createElement(r.ConfirmationModal.Header,null,t("console:manage.features.roles.edit.basics.confirmation.header")),o.createElement(r.ConfirmationModal.Message,{attached:!0,negative:!0},t("console:manage.features.roles.edit.basics.confirmation.message",{type:p?"group.":"role."})),o.createElement(r.ConfirmationModal.Content,null,t("console:manage.features.roles.edit.basics.confirmation.content",{type:p?"group.":"role."}))))},q=n(26264);function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}(e,t)||J(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){if(e){if("string"===typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(e,t):void 0}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Y=function(e){var t=(0,a.$G)().t,n=(0,i.I0)(),r=e.roleObject,l=e.onRoleUpdate,u=e.isReadOnly,c=W((0,o.useState)(void 0),2),m=c[0],p=c[1],g=W((0,o.useState)(!1),2),v=g[0],y=g[1],h=(0,i.v9)((function(e){return e.organization.organization}));(0,o.useEffect)((function(){var e=r.displayName;-1!==e.indexOf("/")?p(e.split("/")[0]):p(C.$R)}),[m,r]);var b=function(e){n((0,f.addAlert)(e))};return o.createElement(q.FK,{"data-testid":"role-mgt-edit-role-users",isGroup:!1,isEdit:!0,isReadOnly:u,userStore:m,assignedUsers:r.users,onSubmit:function(e){var n,o=[],a=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=J(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;o.push(i.id)}}catch(e){a.e(e)}finally{a.f()}var u={operations:[{op:"REPLACE",path:"users",value:o}]};y(!0),(0,s.LK)(h.id,r.id,u).then((function(){b({description:t("console:manage.features.roles.notifications.updateRole.success.description"),level:d.AlertLevels.SUCCESS,message:t("console:manage.features.roles.notifications.updateRole.success.message")}),l()})).catch((function(){b({description:t("console:manage.features.roles.notifications.updateRole.error.description"),level:d.AlertLevels.ERROR,message:t("console:manage.features.roles.notifications.updateRole.error.message")})})).finally((function(){y(!1)}))},isSubmitting:v})};function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ee=function(e){var t=e.roleId,n=e.roleObject,s=e.onRoleUpdate,d=(0,a.$G)().t,f=(0,i.v9)((function(e){return e.config.ui.features})),m=(0,i.v9)((function(e){var t;return null===e||void 0===e||null===(t=e.auth)||void 0===t?void 0:t.allowedScopes})),p=Q((0,o.useState)(!1),2),g=p[0],v=p[1],y=Q((0,o.useState)(!1),2),h=y[0],b=y[1],E=(0,o.useMemo)((function(){var e,t;return h||!(0,c.hasRequiredScopes)(null===f||void 0===f?void 0:f.roles,null===f||void 0===f||null===(e=f.roles)||void 0===e||null===(t=e.scopes)||void 0===t?void 0:t.update,m)||(null===n||void 0===n?void 0:n.displayName)===C.Rw.ORG_CREATOR_ROLE_NAME}),[h,null===f||void 0===f?void 0:f.roles,n,C.Rw.ORG_CREATOR_ROLE_NAME]);(0,o.useEffect)((function(){n&&v(l.m8.location.pathname.includes("/groups/"))}),[n]),(0,o.useEffect)((function(){n&&b(n.displayName===u.RoleConstants.ADMIN_ROLE||n.displayName===u.RoleConstants.ADMIN_GROUP)}),[n]);return o.createElement(r.ResourceTab,{panes:[{menuItem:d("console:manage.features.roles.edit.menuItems.basic"),render:function(){return o.createElement(r.ResourceTab.Pane,{controlledSegmentation:!0,attached:!1},o.createElement(K,{isReadOnly:E,"data-testid":"role-mgt-edit-role-basic",roleId:t,isGroup:g,roleObject:n,onRoleUpdate:s}))}},{menuItem:d("console:manage.features.roles.edit.menuItems.permissions"),render:function(){return o.createElement(r.ResourceTab.Pane,{controlledSegmentation:!0,attached:!1},o.createElement(G,{isReadOnly:E,"data-testid":"role-mgt-edit-role-permissions",isGroup:!1,roleObject:n,onRoleUpdate:s}))}},{menuItem:d("console:manage.features.roles.edit.menuItems.groups"),render:function(){return o.createElement(r.ResourceTab.Pane,{controlledSegmentation:!0,attached:!1},o.createElement(T,{isReadOnly:E,"data-testid":"role-mgt-edit-role-groups",role:n,onRoleUpdate:s}))}},{menuItem:d("console:manage.features.roles.edit.menuItems.users"),render:function(){return o.createElement(r.ResourceTab.Pane,{controlledSegmentation:!0,attached:!1},o.createElement(Y,{isReadOnly:E,"data-testid":"role-mgt-edit-role-users",isGroup:!1,roleObject:n,onRoleUpdate:s}))}}]})};function te(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ne(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var re=function(){var e=(0,a.$G)().t,t=(0,i.v9)((function(e){return e.config.ui.features})),n=te((0,o.useState)(void 0),2),u=n[0],c=n[1],d=te((0,o.useState)(),2),f=d[0],m=d[1],p=te((0,o.useState)(!1),2),g=p[0],v=p[1],y=(0,i.v9)((function(e){return e.organization.organization})),h=function(e){v(!0),(0,s.us)(y.id,e).then((function(e){200===e.status&&m(e.data)})).catch((function(){})).finally((function(){v(!1)}))};(0,o.useEffect)((function(){var e=l.m8.location.pathname.split("/"),t=e[e.length-1];c(t),h(t)}),[]);return o.createElement(r.PageLayout,{isLoading:g,pageTitle:f&&null!==f&&void 0!==f&&f.displayName?null===f||void 0===f?void 0:f.displayName:e("console:manage.pages.rolesEdit.title"),title:"Edit Organization Role",backButton:{onClick:function(){l.m8.push(l.$x.getPaths().get("ORGANIZATION_ROLES"))},text:e("console:manage.pages.rolesEdit.backButton",{type:"roles"})},titleTextAlign:"left",bottomMargin:!1},o.createElement(ee,{roleObject:f,roleId:u,onRoleUpdate:function(){h(u)},featureConfig:t}))}},97532:function(e,t,n){n.d(t,{t:function(){return c}});var r=n(87289),o=n(83108),a=n(50714);function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"generatePermissionTree",value:function(e,t,n){var r=t.shift(),a=n.find((function(e){return e.name===r}));return a||(a={key:e.resourcePath,name:r,title:e.displayName},n.push(a)),t.length&&(0,o.H)(e,t,a.children||(a.children=[])),n}}],(n=null)&&s(t.prototype,n),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();u(c,"permissionJoining",(function(e,t){var n=e.split("/"),r=n.splice(0,t);return n=[r.join("/")].concat(i(e))})),u(c,"getAllOrganizationLevelPermissions",(function(e){return(0,a._W)().then((function(t){if(200===t.status&&t.data&&t.data instanceof Array){var n=(0,r.Z)(e)?t.data:t.data.filter((function(t){return!e.includes(t.resourcePath)})),a=!1;return n.reduce((function(e,t,n){return 0===n&&2==t.resourcePath.replace(/^\/|\/$/g,"").split("/").length&&(a=!0),a?(0,o.H)(t,c.permissionJoining(t.resourcePath.replace(/^\/|\/$/g,""),2),e):(0,o.H)(t,t.resourcePath.replace(/^\/|\/$/g,"").split("/"),e)}),[])}}))}))}}]);